# Задание на экзамен "Вариант 7: Аренда автомобилей"

## Описание проекта и его функционала

"Вариант 7: Аренда автомобилей" это веб API для аренды автомобилей. 
Позволяет вести учет авто, офромлять аренду авто на определенный период времени и оставлять отзывы на авто.
Содержит документацию Swagger.

## Используемые технологии и их версии

Основные технологии: FastAPI, SqlAlchemy, Pydantic. Полный список технологий с версиями можно найти в файле requirements.txt.

## Инструкция по запуску

Ниже приведено описание действия, необходимых для заупска, и команды для ОС Windows.

> Все действия по запуску обязательно нужно призводить находясь в корневой директории проекта

**1. Создание виртуального окружения**
```
python -m venv venv
```

**2. Активация виртуального окружения**
```
venv\Scripts\activate
```

**3. Установка пакетов**
```
pip install -r requirements.txt
```

**4. Посев данных**
```
python src/seed.py
```

**5. Запуск**
```
fastapi dev src/main.py
```

**6. Тестирование**

Перейдите по адресу `http://127.0.0.1:8000/docs` в браузере. Откроется интерфейс Swagger для удобного тестирования.

## Описание API

Это REST API, данные передаются в парамтерах URL-адреса или в теле запроса в формате JSON.

Все эндпоинты задокументированы при помощи Swagger. Чтобы получить доступ к документации запустите проект и перейдите по адресу `http://127.0.0.1:8000/docs`.

Выполненны все функциональные требования.

**Особенности API:**

- При удалении сущности не происходолит удаление записи из базы данных.
  Просто значение атрибута is_active меняется на False (0).
  Далее при любой фильтрации или поиске по id эти сущности будут проигнорированы.
  Это сделано для предотвращения полной потери данных, в том числе данных логирования, при удалении.

- Все даты, даты-время в аргументах и полях запросов и ответов указаны (должны быть указаны) в часовом поясе UTC.

- Для логирования каждой сущности в базе данных добавлен атрибут meta. 
  Атрибут meta содержит JSON-строку с полями 
  created_by, updated_by - id пользователя создавшего и обновившего в последний раз эту запись, 
  created_at, updated_at - дата-время создания и последнего обновления. 
  Meta возвращается вместе с данными сущности в ответах API, но не у всех пользователей есть права на meta для любой сущности. 
  Если в ответе на запрос нет meta, значит у пользователя нет на них прав. Например у клиента нет прав на meta для автомобилей.

- При пагинации значение параметра page всегда начинается с 0. `page=0` означает запрос первой страницы.

- При бронировании авто на срок 7 или более дней дается скидка 10%, при бронировании на 30 или более дней - 15%.

## Описание валидации к ключевым эндпоинтам

Все схемы данных и их валидация подробно описаны в документации Swagger.

Все маршруты, изменяющие данные, или дающие доступ к чувствительным данным, защищены при помощи Bearer токенов.

## Описание ролей пользователей и их прав

Роли:
- Клиент – просмотр авто, аренда, отзывы.
- Менеджер – управление автомобилями и арендами.
- Админ – управление пользователями

Все эндпоинты, кроме общедоступных, содержат роль в качестве второго параметра пути. Следоватьельно пути эндпоинтов клиента начинаются с `/api/c`, пути менеджера начинаются с `/api/m`, пути админа начинаются с `/api/a`.

Посев уже содержит пользователей всех ролей (таблица ниже), но так же предусмотрены энпоинты для регистрации: `POST` `/api/user/sign/up` - открытый, для регистрации клиентов и `POST` `/api/a/user/sign/up/{role}` - админский, для регистрации любой роли.

Email | Пароль | Роль
--- | --- | ---
admin@example.com | 12345678 | Админ
manager@example.com | 12345678 | Менеджер
client@example.com | 12345678 | Клиент
user@example.com | 12345678 | Клиент

Чтобы авторизоваться используйте общедоступный эндпоинт авторизации `POST` `/api/user/sign/in`:

- в документации Swagger, выберите роль из примеров Body параметра, или введеите данные авторизации сами
- скопируйте access_token из ответа
- нажмите Authorize вверху страницы, вставьте токен в поле Value (БЕЗ ПРЕФИКСА "Bearer")
- нажмите Authorize, затем Close

Токен будет действителен в течении часа

Токен открывает доступ к эндпоинтам только одной роли пользователя, 
не забывайте менять токен при тестировании эндпоинтов разных ролей.

## Контакты

Егор Гологузов, студент НТИ (филиал УРФУ), группы Т-323901-НТ.

Email: `gologuzovegor@gmail.com`
Телеграм: `https://t.me/xlebushek_telegram`
ВК: `https://vk.com/ddddich`
